# 条件概率的定义和公式

- 条件概率：事件 $B$ 已发生条件下事件 $A$ 发生的概率，记为 $P(A|B)$，即

$$
P(A|B) = \frac{P(AB)}{P(B)}
$$

- 乘法定理：

$$
P(AB) = P(A) P(B|A)
$$

- 全概率公式：

$$
\begin{aligned}
P(B) &= P(A_1)P(B|A_1) + P(A_2)P(B|A_2) + ... + P(A_n)P(B|A_n) \\
&= \sum_{i=1}^{n} P(A_i)P(B|A_i)
\end{aligned}
$$

- 贝叶斯（Bayes）公式（逆概率公式）：

$$
\begin{aligned}
P(A_i|B) &= \frac{P(A_iB)}{P(B)} \\
&= \frac{P(A_i)P(B|A_i)}{P(A_1)P(B|A_1) + P(A_2)P(B|A_2) + ... + P(A_n)P(B|A_n)} \\
&= \frac{P(A_i)P(B|A_i)}{\sum_{i=1}^{n} P(A_i)P(B|A_i)}
\end{aligned}
$$

- 独立概率的乘法规则：事件 $A$ 和事件 $B$ 必须**相互独立**，即一个事件的发生不会影响另一个事件的发生，此时有

$$
P(AB) = P(A) P(B) \\
P(A|B) = P(A|\overline{B}) = P(A) \\
P(B|A) = P(B|\overline{A}) = P(B)
$$

- 一些小技巧：
  - $P(A) = P(A|B) + P(A|\overline{B})$
  - $P(AB|C) = P(A|C) P(B|C)$


# 先验概率和后验概率

定义：

- 先验概率：开始时，我们手中没有任何信息，只能计算一个初始概率。
- 事件：新的事件发生，有了新的信息。
- 后验概率：根据这些新信息和先验概率可以得到更好的概率估计。

例如，我们想得知今天下雨的概率：

- 先验概率：开始时，我们手中没有任何信息，只能粗略估计今天下雨的概率为 20%。
- 事件：我们在亚马逊雨林中。
- 后验概率：因此，今天下雨的概率被修正为 70%。

让我们再看以下例子。

【例】某种诊断癌症的试验具有如下效果：被诊断者有癌症，试验反应为阳性的概率为0.95；被诊断者没有癌症，试验反应为阴性的概率为 0.95。现对自然人群进行普查，设被试验的人群中患有癌症的概率为0.005，求：已知试验反应为阳性，该被诊断者确有癌症的概率。

【解】设 $A$ 表示“患有癌症”，$\overline{A}$ 表示“患有癌症”；$B$ 表示“试验反应为阳性”，$\overline{B}$ 表示“试验反应为阴性”。由题意得

$$
P(A) =0.005, P(\overline{A}) = 0.995 \\
P(B|A) = 0.95, P(\overline{B}|\overline{A}) = 0.05 \\
P(B|\overline{A}) = 1 - P(\overline{B}|\overline{A}) = 0.95
$$

由贝叶斯公式得：

$$
\begin{aligned}
P(A|B) &= \frac{P(AB)}{P(B)} \\
&= \frac{P(A)P(B|A)}{P(A)P(B|A) + P(\overline{A})P(B|\overline{A})} \\
&= 0.087
\end{aligned}
$$

通过以上例子可知：

- 先验概率：根据对自然人群的普查，被试验的人群中患有癌症的概率为0.005（同样，没有癌症的概率为0.995）。
- 事件：患者接受了试验，且结果为阳性。
- 后验概率：在得到试验反应为阳性后，该被诊断者确有癌症的概率被修正为 0.087。

# 使用朴素贝叶斯（Naive Bayes）算法检测垃圾邮件

设电子邮件有 $n$ 个单词 $x_1, x_2, ..., x_n$，则邮件是垃圾邮件的概率为：

$$
P(垃圾邮件 | x_1, x_2, ..., x_n) = \frac{P(x_1, x_2, ..., x_n | 垃圾邮件) P(垃圾邮件)}{P(x_1, x_2, ..., x_n | 垃圾邮件) P(垃圾邮件) + P(x_1, x_2, ..., x_n | 非垃圾邮件) P(非垃圾邮件)}
$$

假设所有单词的出现都是独立的，则有：

$$
P(x_1, x_2, ..., x_n | 垃圾邮件) = P(x_1 | 垃圾邮件) P(x_2 | 垃圾邮件) ... P(x_n | 垃圾邮件) = \prod_i^n P(x_i | 垃圾邮件) \\
P(x_1, x_2, ..., x_n | 非垃圾邮件) = P(x_1 | 非垃圾邮件) P(x_2 | 非垃圾邮件) ... P(x_n | 非垃圾邮件) = \prod_i^n P(x_i | 非垃圾邮件)
$$

根据条件概率公式有：

$$
P(x_i | 垃圾邮件) = \frac{P(出现 x_i 的垃圾邮件)}{P(垃圾邮件)} = \frac{出现 x_i 的垃圾邮件数}{电子邮件总数} \cdot \frac{电子邮件总数}{垃圾邮件总数} = \frac{出现 x_i 的垃圾邮件数}{垃圾邮件总数} \\
同理，P(x_i | 非垃圾邮件) = \frac{出现 x_i 的非垃圾邮件数}{非垃圾邮件总数} \\
$$

所以：

$$
P(垃圾邮件 | x_1, x_2, ..., x_n) = \frac{\frac{垃圾邮件总数}{电子邮件总数} \cdot \prod_i^n \frac{出现 x_i 的垃圾邮件数}{垃圾邮件总数} }{\frac{垃圾邮件总数}{电子邮件总数} \cdot \prod_i^n \frac{出现 x_i 的垃圾邮件数}{垃圾邮件总数} + \frac{垃圾邮件总数}{电子邮件总数} \cdot \prod_i^n \frac{出现 x_i 的非垃圾邮件数}{非垃圾邮件总数}}
$$

化简得：

$$
P(垃圾邮件 | x_1, x_2, ..., x_n) = \frac{垃圾邮件总数 \cdot \prod_i^n \frac{出现 x_i 的垃圾邮件数}{垃圾邮件总数} }{垃圾邮件总数 \cdot \prod_i^n \frac{出现 x_i 的垃圾邮件数}{垃圾邮件总数} + 非垃圾邮件总数 \cdot \prod_i^n \frac{出现 x_i 的非垃圾邮件数}{非垃圾邮件总数}}
$$








